<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <link rel="stylesheet" type="text/css" href="classy.css">
  </head>
  <body>
    <h1 id = "pageTop"></h1>
    
    <div class = inputVals>
      <form>
        <br>GOAT</br>
        <div class= "userName"> <input type="text" id="handle"> 
        </div>
        <br>SCREAM</br>
        <div class = 'message'> 
          <textarea cols="50" rows="4" id="comment"></textarea>
        </div>
      </form>
    
    <button type="button">BAAAAA!(POST)</button>
    </div>
    <script>
      // 
    // var selectGoatList = function(goat){
        // console.log('clicked')
        // console.log($this);
        // var goat = String(goat)
        // console.log(goat);
        // var targetAcquired = document.getElementById(goat);
        // console.log(targetAcquired);
        // console.log(typeof goat);
        
        // console.log("clicked");
        // alert("clickable");
    // };
     var addRow = function(goats,goatCall,goatTime){
         if (!document.getElementsByTagName) return;
         tabBody=document.getElementsByTagName("tbody").item(0);
         row=document.createElement("tr");
         cell1 = document.createElement("td","button");
         var goat = String(goats);
         cell1.setAttribute('id', goat);        
         
         // console.log(goat);
         // cell1.setAttribute('onclick','selectGoatList()');
         cell2 = document.createElement("td");
         cell3 = document.createElement("td");
         textnode1=document.createTextNode("@" + goats);
         textnode2=document.createTextNode(goatCall);
         textnode3=document.createTextNode(goatTime);
         cell1.appendChild(textnode1);
         cell2.appendChild(textnode2);
         cell3.appendChild(textnode3);
         row.appendChild(cell1);
         row.appendChild(cell2);
         row.appendChild(cell3);
         tabBody.appendChild(row);


    
    };
     var updateLures = function(startTrigger, specificGoat){
        $('td').remove();
        
        // if (startTrigger === "startTrigger"){
          // var index = 0}
        // else{
          // index = +$index;};
        index = 0; 
        allLures = streams.home.length - 1;
        index = makeTable(index, allLures);
        
        $index = index;
      };
    var makeTable = function(index, allLures, specName){
      // console.log(specName);
      if (specName){
        var lister = specName;
      }
      else{
        var lister = streams.home;
      };
      // console.log(lister);
      while(index <= allLures){
          var tweet = lister[index];
          addRow(tweet.user,tweet.message,tweet.created_at);
          index += 1;
        
        }
        return index;
      };
      
      var showSpecName = function(handle){
        var specArr = [];
        for (var i = 0; (streams.home.length - 1) > i; i++){
            if (streams.home[i].user === handle){
              specArr.push(streams.home[i]);
            }
          
        };
        $('td').remove();
        makeTable(0, (specArr.length- 1), specArr)

      };
      $(document).ready(function(){
        updateLures('startTrigger');
        $("#pageTop").text("TwitterGoat");

        $(".inputVals").on('click','button', function(){
              var handleToAdd = document.getElementById('handle').value;
              var messageToAdd = document.getElementById('comment').value;
              (streams.home).push({"user" : handleToAdd, "message" : messageToAdd, "created_at": new Date()});
          updateLures();
        
        
        })
        
        
        var table = document.getElementById("mytable");
        console.log(table);
        var cellOfHandle = table.getElementsByTagName("td");
        console.log(cellOfHandle);
        
        for (var i = 0; i < cellOfHandle.length; i++){
          cellOfHandle[i].onclick = function(){
            // console.log(this.);
            var selectedHandle = this.innerHTML;
            re = /@*/;
            if ((selectedHandle.match(re))!== null){
              // console.log('yay')
              selectedHandle = selectedHandle.replace('@','');
              showSpecName(selectedHandle);
            };
              
          }

        };
       
      });

    </script>
    <div id = "tweetTable">
      <table border='1' id='mytable'>
        <tbody>
          <tr>
            <th>Goat</th>
              <th>Scream!</th>
              <th>Time</th>
          </tr>
        </tbody>
      </table>
    </div>
      
  </body>
</html>
